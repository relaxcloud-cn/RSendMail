# RSendMail GUI 功能设计文档

基于 Slint 框架的图形用户界面设计方案

---

## 1. 产品定位与用户场景分析

### 1.1 产品定位

RSendMail 是一个**高性能批量邮件发送测试工具**，主要用于：
- 邮件系统压力测试
- SMTP 服务器功能验证
- 邮件投递能力测试
- 批量邮件发送自动化

### 1.2 目标用户

| 用户类型 | 使用场景 | 核心需求 |
|----------|----------|----------|
| **邮件系统运维** | 测试 SMTP 服务器性能和稳定性 | 高并发、实时监控、错误追踪 |
| **邮件产品开发** | 验证邮件功能是否正常 | 快速配置、灵活发送、查看结果 |
| **QA 测试人员** | 邮件功能回归测试 | 批量发送、重复执行、日志记录 |
| **IT 管理员** | 验证邮件服务配置 | 连接测试、认证验证、TLS 检查 |

### 1.3 典型用户故事

**场景 1：邮件服务器压力测试**
> "我需要测试新部署的邮件服务器能否承受每秒 100 封邮件的压力，需要持续发送 10 分钟，观察是否有失败。"

**场景 2：邮件模板批量发送**
> "我有 500 个 EML 文件需要发送到测试邮箱，验证邮件内容是否正确渲染。"

**场景 3：附件投递测试**
> "我需要测试不同大小、不同格式的附件能否正常发送和接收。"

**场景 4：SMTP 认证验证**
> "我需要验证公司邮箱账号的 SMTP 配置是否正确，能否正常发送邮件。"

---

## 2. 核心业务流程

### 2.1 用户操作主流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      用户核心操作流程                            │
└─────────────────────────────────────────────────────────────────┘

    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │ 1. 配置  │────▶│ 2. 验证  │────▶│ 3. 发送  │────▶│ 4. 分析  │
    │ SMTP连接 │     │ 连接有效 │     │ 执行任务 │     │ 查看结果 │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
         │                │                │                │
         ▼                ▼                ▼                ▼
    ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
    │·服务器   │     │·测试连接 │     │·实时进度 │     │·成功/失败│
    │·端口/TLS │     │·验证认证 │     │·可中断   │     │·错误分类 │
    │·认证凭据 │     │·快速反馈 │     │·日志输出 │     │·导出报告 │
    └──────────┘     └──────────┘     └──────────┘     └──────────┘
```

### 2.2 三种发送模式的业务场景

```
                    ┌─────────────────┐
                    │   选择发送模式   │
                    └────────┬────────┘
                             │
         ┌───────────────────┼───────────────────┐
         ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  EML 批量发送   │ │  单文件附件发送  │ │  目录批量附件   │
├─────────────────┤ ├─────────────────┤ ├─────────────────┤
│                 │ │                 │ │                 │
│ 场景：          │ │ 场景：          │ │ 场景：          │
│ ·邮件模板测试   │ │ ·快速测试附件   │ │ ·批量文件分发   │
│ ·历史邮件重发   │ │ ·验证单个文件   │ │ ·多附件测试     │
│ ·压力测试      │ │                 │ │                 │
│                 │ │                 │ │                 │
│ 输入：          │ │ 输入：          │ │ 输入：          │
│ ·EML文件目录   │ │ ·单个文件路径   │ │ ·文件目录       │
│                 │ │ ·邮件主题/正文  │ │ ·邮件模板       │
│                 │ │                 │ │                 │
│ 特点：          │ │ 特点：          │ │ 特点：          │
│ ·多进程并发    │ │ ·构建完整邮件   │ │ ·每文件一封邮件 │
│ ·保持原始内容  │ │ ·自动MIME检测   │ │ ·支持模板变量   │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

### 2.3 发送执行流程

```
┌─────────────────────────────────────────────────────────────────┐
│                       发送执行流程                               │
└─────────────────────────────────────────────────────────────────┘

  开始发送
      │
      ▼
┌──────────────┐    失败     ┌──────────────┐
│  建立SMTP连接 │───────────▶│  记录错误    │
└──────┬───────┘             │  等待重试    │
       │成功                  └──────────────┘
       ▼
┌──────────────┐
│  扫描邮件文件 │──────┐
└──────┬───────┘      │
       │              │ 按进程数分组
       ▼              │
┌──────────────┐      │
│  分配到多进程 │◀─────┘
└──────┬───────┘
       │
       ▼ 每个进程
┌──────────────────────────────────────┐
│  ┌─────────────────────────────────┐ │
│  │          批次循环               │ │
│  │  ┌───────────────────────────┐  │ │
│  │  │ 1. MAIL FROM (设置发件人) │  │ │
│  │  │ 2. RCPT TO (设置收件人)   │  │ │
│  │  │ 3. DATA (发送邮件内容)    │  │ │
│  │  │ 4. RSET (重置状态)        │  │ │
│  │  │ 5. 记录结果               │  │ │
│  │  └───────────────────────────┘  │ │
│  │          ↓                      │ │
│  │    检查是否继续/中断             │ │
│  └─────────────────────────────────┘ │
└──────────────────────────────────────┘
       │
       ▼
┌──────────────┐
│  汇总统计结果 │
└──────┬───────┘
       │
       ▼
┌──────────────┐    是      ┌──────────────┐
│  是否需要循环 │──────────▶│  等待间隔    │──┐
└──────┬───────┘            └──────────────┘  │
       │否                                     │
       ▼                                       │
┌──────────────┐                              │
│  输出最终报告 │◀─────────────────────────────┘
└──────────────┘
```

---

## 3. GUI 界面设计

### 3.1 设计原则

1. **任务导向**：界面围绕"配置 → 验证 → 发送 → 分析"主流程设计
2. **渐进披露**：常用选项直接展示，高级选项折叠隐藏
3. **即时反馈**：操作结果实时显示，错误及时提示
4. **状态可见**：发送进度、统计数据随时可查

### 3.2 整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  RSendMail                                         [_] [□] [X]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────┬───────────────────────────┐│
│  │                                 │                           ││
│  │      左侧：配置区域              │     右侧：监控区域        ││
│  │                                 │                           ││
│  │  ┌───────────────────────────┐  │  ┌───────────────────────┐││
│  │  │    SMTP 服务器配置        │  │  │    实时统计面板       │││
│  │  └───────────────────────────┘  │  └───────────────────────┘││
│  │                                 │                           ││
│  │  ┌───────────────────────────┐  │  ┌───────────────────────┐││
│  │  │    发送模式选择           │  │  │    发送日志           │││
│  │  │    + 模式相关配置         │  │  │    (实时滚动)         │││
│  │  └───────────────────────────┘  │  │                       │││
│  │                                 │  │                       │││
│  │  ┌───────────────────────────┐  │  │                       │││
│  │  │ ▶ 高级选项（可折叠）      │  │  │                       │││
│  │  └───────────────────────────┘  │  └───────────────────────┘││
│  │                                 │                           ││
│  └─────────────────────────────────┴───────────────────────────┘│
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  ● 就绪  │  进度: --  │  成功: 0  │  失败: 0  │  [测试连接] [开始发送] │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 左侧配置区域详细设计

#### 3.3.1 SMTP 服务器配置（始终展示）

```
┌─ SMTP 服务器 ──────────────────────────────────────────────────┐
│                                                                │
│  服务器地址    [smtp.example.com_______________]               │
│                                                                │
│  端口          [465_____]    ○ 25   ○ 465(SSL)   ○ 587         │
│                                                                │
│  ☑ 使用 TLS 加密              ☐ 接受自签名证书                 │
│                                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
│                                                                │
│  ☑ 需要认证                                                    │
│     用户名     [user@example.com_______________]               │
│     密码       [••••••••••••____________________] [👁]         │
│                                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
│                                                                │
│  发件人        [sender@example.com_____________]               │
│  收件人        [test@example.com_______________] (逗号分隔多个)│
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.2 发送模式选择（核心交互）

```
┌─ 发送模式 ─────────────────────────────────────────────────────┐
│                                                                │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐      │
│  │  📧 EML批量    │ │  📎 单个附件   │ │  📁 目录附件   │      │
│  │   （选中）     │ │                │ │                │      │
│  └────────────────┘ └────────────────┘ └────────────────┘      │
│                                                                │
│  ════════════════════════════════════════════════════════════  │
│                                                                │
│  【EML批量模式 配置】                                          │
│                                                                │
│  EML 目录      [/path/to/emails________________] [浏览...]     │
│  文件扩展名    [eml_____]                                      │
│                                                                │
│  扫描结果: 找到 156 个 .eml 文件                               │
│                                                                │
└────────────────────────────────────────────────────────────────┘

--- 或者，当选择"单个附件"模式时 ---

┌─ 发送模式 ─────────────────────────────────────────────────────┐
│  ...（模式选择按钮）...                                        │
│                                                                │
│  【单个附件模式 配置】                                          │
│                                                                │
│  附件文件      [/path/to/document.pdf__________] [浏览...]     │
│                                                                │
│  邮件主题      [附件: {filename}_______________]               │
│  邮件正文      [请查收附件: {filename}_________]               │
│                                                                │
│  💡 提示: 使用 {filename} 自动插入文件名                       │
│                                                                │
└────────────────────────────────────────────────────────────────┘

--- 或者，当选择"目录附件"模式时 ---

┌─ 发送模式 ─────────────────────────────────────────────────────┐
│  ...（模式选择按钮）...                                        │
│                                                                │
│  【目录附件模式 配置】                                          │
│                                                                │
│  附件目录      [/path/to/documents_____________] [浏览...]     │
│                                                                │
│  扫描结果: 找到 23 个文件                                      │
│                                                                │
│  邮件主题      [文件: {filename}_______________]               │
│  邮件正文      [请查收附件: {filename}_________]               │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 3.3.3 高级选项（可折叠）

```
┌─ ▶ 高级选项 ───────────────────────────────────────────────────┐
│  （点击展开）                                                   │
└────────────────────────────────────────────────────────────────┘

展开后：

┌─ ▼ 高级选项 ───────────────────────────────────────────────────┐
│                                                                │
│  【性能配置】                                                   │
│  并发进程数    [auto____] ▼     批量大小    [1_______]         │
│  发送间隔      [0_______] ms    连接超时    [30______] 秒      │
│                                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
│                                                                │
│  【循环发送】                                                   │
│  ☐ 无限循环    重复次数  [1_______]                            │
│  循环间隔      [1_______] 秒    重试间隔  [5_______] 秒        │
│                                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
│                                                                │
│  【邮件处理】（仅 EML 模式）                                    │
│  ○ 保持原始内容    ○ 保留邮件头    ○ 修改邮件头                │
│  ☐ 匿名化邮箱地址    匿名域名 [example.com________]            │
│                                                                │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │
│                                                                │
│  【日志与错误处理】                                             │
│  日志级别      [Info____] ▼                                    │
│  日志文件      [________________________] [浏览...] (可选)     │
│  失败邮件目录  [________________________] [浏览...] (可选)     │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 3.4 右侧监控区域详细设计

#### 3.4.1 实时统计面板

```
┌─ 发送统计 ─────────────────────────────────────────────────────┐
│                                                                │
│    ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│    │   总计   │  │   成功   │  │   失败   │  │   QPS    │     │
│    │   156    │  │   150    │  │    6     │  │  12.5    │     │
│    └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                                │
│    进度: ████████████████████░░░░░░░░░░  78% (156/200)        │
│                                                                │
│    当前轮次: 1/3    已用时间: 00:02:34    预计剩余: 00:00:45   │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 3.4.2 发送日志（实时滚动）

```
┌─ 发送日志 ─────────────────────────────────────────────────────┐
│                                                                │
│  [10:30:45] [INFO]  开始第 1/3 轮发送                          │
│  [10:30:45] [INFO]  连接SMTP服务器: smtp.example.com:465       │
│  [10:30:46] [INFO]  使用TLS连接 (认证模式)                     │
│  [10:30:46] [INFO]  自动设置进程数为: 8                        │
│  [10:30:47] [INFO]  进程组 1 开始发送第 1/5 批                 │
│  [10:30:47] [INFO]  邮件发送成功！: /emails/001.eml            │
│  [10:30:48] [INFO]  邮件发送成功！: /emails/002.eml            │
│  [10:30:49] [WARN]  设置收件人失败: invalid@bad                │
│  [10:30:50] [ERROR] 邮件发送超时: /emails/003.eml              │
│  [10:30:50] [INFO]  已保存失败邮件: /emails/003.eml            │
│  ...                                                           │
│                                                  ▼ 自动滚动 ☑ │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│  [清空] [导出日志]                    日志级别过滤: [全部 ▼]   │
└────────────────────────────────────────────────────────────────┘
```

#### 3.4.3 错误分析面板（发送完成后显示）

```
┌─ 错误分析 ─────────────────────────────────────────────────────┐
│                                                                │
│  错误类型分布:                                                  │
│  ├─ SMTP连接超时        ████████░░░░░░░░░░  3 封 (50.0%)       │
│  ├─ 设置收件人失败      █████░░░░░░░░░░░░░  2 封 (33.3%)       │
│  └─ 邮件发送失败        ██░░░░░░░░░░░░░░░░  1 封 (16.7%)       │
│                                                                │
│  失败文件列表:                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ /path/to/emails/003.eml    SMTP连接超时               │    │
│  │ /path/to/emails/015.eml    设置收件人失败             │    │
│  │ /path/to/emails/089.eml    SMTP连接超时               │    │
│  │ ...                                                    │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                │
│  [导出失败列表] [重新发送失败邮件]                              │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 3.5 底部状态栏

```
等待状态:
┌─────────────────────────────────────────────────────────────────┐
│ ● 就绪  │  --  │  成功: 0  │  失败: 0  │  [测试连接] [开始发送] │
└─────────────────────────────────────────────────────────────────┘

发送中状态:
┌─────────────────────────────────────────────────────────────────┐
│ ◉ 发送中  │ 78% (156/200) │ 成功: 150 │ 失败: 6 │ [停止发送]   │
└─────────────────────────────────────────────────────────────────┘

发送完成状态:
┌─────────────────────────────────────────────────────────────────┐
│ ✓ 完成  │ 用时: 2分34秒 │ 成功: 194 │ 失败: 6 │ [导出报告] [再次发送] │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 交互流程设计

### 4.1 首次使用流程

```
1. 用户启动应用
   ↓
2. 界面显示空白配置状态
   ↓
3. 用户填写 SMTP 服务器信息
   ↓
4. 点击 [测试连接]
   ↓
   ├─ 成功 → 显示 ✓ 连接成功，可以继续配置
   └─ 失败 → 显示错误信息，提示修改
   ↓
5. 选择发送模式，配置相关参数
   ↓
6. 点击 [开始发送]
   ↓
7. 实时观察进度和日志
   ↓
   ├─ 发送完成 → 显示统计报告
   └─ 手动停止 → 显示已发送统计
```

### 4.2 测试连接功能

**目的**：在正式发送前验证 SMTP 配置是否正确

**触发**：点击 [测试连接] 按钮

**过程**：
1. 验证必填字段是否完整
2. 尝试建立 SMTP 连接
3. 如果启用认证，验证用户名密码
4. 显示结果（成功/失败原因）

**反馈**：
```
成功：
┌──────────────────────────────────────┐
│  ✓ 连接成功                          │
│                                      │
│  服务器: smtp.example.com:465        │
│  连接方式: TLS (SMTPS)               │
│  认证状态: 已通过                    │
│  响应时间: 156ms                     │
│                                      │
│                            [确定]    │
└──────────────────────────────────────┘

失败：
┌──────────────────────────────────────┐
│  ✗ 连接失败                          │
│                                      │
│  错误: 认证失败 - 用户名或密码错误    │
│                                      │
│  建议:                               │
│  · 检查用户名是否正确                │
│  · 确认密码没有特殊字符问题          │
│  · 部分邮箱需要使用授权码            │
│                                      │
│                            [确定]    │
└──────────────────────────────────────┘
```

### 4.3 发送控制流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        发送状态机                                │
└─────────────────────────────────────────────────────────────────┘

        ┌──────────┐
        │   空闲   │◀─────────────────────────────┐
        └────┬─────┘                              │
             │ [开始发送]                          │
             ▼                                    │
        ┌──────────┐                              │
        │  准备中  │  (扫描文件、验证配置)          │
        └────┬─────┘                              │
             │                                    │
             ▼                                    │
        ┌──────────┐     [停止发送]          ┌────┴─────┐
        │  发送中  │─────────────────────────▶│  已停止  │
        └────┬─────┘                         └──────────┘
             │ 全部完成                            ▲
             ▼                                    │
        ┌──────────┐     [再次发送]               │
        │  已完成  │─────────────────────────────┘
        └──────────┘

```

### 4.4 中断与恢复

**优雅中断**：
- 用户点击 [停止发送]
- 等待当前正在发送的邮件完成
- 统计已发送的结果
- 返回空闲状态

**失败邮件处理**：
- 如果配置了失败邮件目录，自动保存失败的邮件
- 发送完成后可以查看失败列表
- 提供"重新发送失败邮件"功能（读取失败目录重新发送）

---

## 5. 配置管理

### 5.1 配置保存与加载

```
菜单栏:
┌─────────────────────────────────────────────────────────────────┐
│  文件(F)  编辑(E)  帮助(H)                                       │
├─────────────────────────────────────────────────────────────────┤
│  ├─ 新建配置        Ctrl+N                                      │
│  ├─ 打开配置...     Ctrl+O                                      │
│  ├─ 保存配置        Ctrl+S                                      │
│  ├─ 另存为...       Ctrl+Shift+S                                │
│  ├─────────────────────────                                     │
│  ├─ 最近使用的配置  ▶                                           │
│  │   ├─ 公司邮箱测试.json                                       │
│  │   ├─ 压力测试配置.json                                       │
│  │   └─ 阿里云邮箱.json                                         │
│  ├─────────────────────────                                     │
│  └─ 退出            Ctrl+Q                                      │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 配置文件格式 (JSON)

```json
{
  "version": "1.0",
  "name": "公司邮箱测试",
  "smtp": {
    "server": "smtp.company.com",
    "port": 465,
    "use_tls": true,
    "accept_invalid_certs": false,
    "auth_mode": true,
    "username": "user@company.com"
    // 注意：密码不保存，每次需要重新输入
  },
  "sender": {
    "from": "sender@company.com",
    "to": "test@company.com"
  },
  "mode": {
    "type": "eml_batch",
    "dir": "/path/to/emails",
    "extension": "eml"
  },
  "advanced": {
    "processes": "auto",
    "batch_size": 5,
    "email_send_interval_ms": 100,
    "smtp_timeout": 30,
    "loop": false,
    "repeat": 1
  }
}
```

---

## 6. 快捷键设计

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl+N` | 新建配置 | 清空当前配置 |
| `Ctrl+O` | 打开配置 | 加载配置文件 |
| `Ctrl+S` | 保存配置 | 保存当前配置 |
| `Ctrl+T` | 测试连接 | 测试 SMTP 连接 |
| `Ctrl+Enter` | 开始发送 | 启动发送任务 |
| `Ctrl+.` | 停止发送 | 中断发送任务 |
| `Ctrl+L` | 清空日志 | 清空日志面板 |
| `Esc` | 停止发送 | 同 Ctrl+. |

---

## 7. 错误处理与用户提示

### 7.1 输入验证

| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| SMTP 服务器 | 非空 | "请输入 SMTP 服务器地址" |
| 端口 | 1-65535 | "端口号必须在 1-65535 之间" |
| 发件人 | 邮箱格式 | "请输入有效的邮箱地址" |
| 收件人 | 邮箱格式（逗号分隔） | "收件人格式无效" |
| EML 目录 | 目录存在 | "目录不存在或无法访问" |
| 附件文件 | 文件存在 | "文件不存在或无法读取" |

### 7.2 运行时错误

| 错误类型 | 用户提示 | 建议操作 |
|----------|----------|----------|
| 连接超时 | "SMTP 服务器连接超时" | 检查网络或增加超时时间 |
| 认证失败 | "认证失败：用户名或密码错误" | 检查凭据，部分邮箱需要授权码 |
| TLS 握手失败 | "TLS 连接失败" | 检查端口，尝试勾选"接受自签名证书" |
| 发件人被拒 | "发件人地址被服务器拒绝" | 检查发件人地址是否与账号匹配 |
| 收件人被拒 | "收件人地址无效" | 检查收件人邮箱是否正确 |

---

## 8. 技术实现架构

### 8.1 项目结构

```
rsendmail-gui/
├── Cargo.toml
├── build.rs                    # Slint 编译配置
├── ui/
│   ├── main.slint              # 主窗口布局
│   ├── app.slint               # 应用全局样式和逻辑
│   ├── components/
│   │   ├── smtp_config.slint   # SMTP 配置组件
│   │   ├── mode_selector.slint # 模式选择组件
│   │   ├── advanced_options.slint
│   │   ├── stats_panel.slint   # 统计面板
│   │   ├── log_panel.slint     # 日志面板
│   │   └── status_bar.slint    # 状态栏
│   └── widgets/
│       ├── labeled_input.slint
│       ├── file_picker.slint
│       └── collapsible.slint   # 可折叠面板
└── src/
    ├── main.rs                 # 入口，初始化 Slint
    ├── app.rs                  # 应用主逻辑
    ├── state.rs                # 状态管理
    ├── config_io.rs            # 配置文件读写
    ├── sender.rs               # 发送逻辑（复用 CLI 核心）
    └── bridge.rs               # Slint <-> Rust 桥接
```

### 8.2 核心代码复用

GUI 应用将复用 CLI 中的核心模块：

```rust
// 将现有 rsendmail 重构为库 + 二进制结构
// rsendmail-core/src/lib.rs

pub mod config;     // Config 结构（移除 clap 依赖，作为纯数据结构）
pub mod mailer;     // Mailer 发送逻辑
pub mod stats;      // Stats 统计
pub mod anonymizer; // EmailAnonymizer

// GUI 中使用
use rsendmail_core::{Config, Mailer, Stats};
```

### 8.3 异步发送与 UI 更新

```rust
// 使用 channel 进行 GUI 和发送任务之间的通信

enum SendEvent {
    Progress { sent: usize, total: usize },
    EmailSent { path: String, success: bool, error: Option<String> },
    Log { level: LogLevel, message: String },
    Completed { stats: Stats },
    Error { message: String },
}

// 在 Slint 中处理更新
slint::spawn_local(async move {
    while let Some(event) = rx.recv().await {
        match event {
            SendEvent::Progress { sent, total } => {
                app.set_sent_count(sent as i32);
                app.set_total_count(total as i32);
            }
            // ...
        }
    }
});
```

---

## 9. 开发计划

### Phase 1: 基础功能
- [ ] 项目初始化和 Slint 环境搭建
- [ ] 核心代码重构为库结构
- [ ] 基础 UI 布局实现
- [ ] SMTP 配置界面
- [ ] 测试连接功能

### Phase 2: 发送功能
- [ ] 发送模式选择和配置
- [ ] 发送任务执行
- [ ] 实时进度显示
- [ ] 停止发送功能

### Phase 3: 监控与日志
- [ ] 实时日志显示
- [ ] 统计面板
- [ ] 错误分析视图

### Phase 4: 配置管理
- [ ] 配置保存/加载
- [ ] 最近使用列表
- [ ] 快捷键支持

### Phase 5: 完善与优化
- [ ] 错误处理优化
- [ ] UI 美化
- [ ] 多语言支持（可选）
- [ ] 打包与分发
